echo "ğŸ”’ Running pre-push quality checks..."
echo ""

# Kolla om nya migrationer ingÃ¥r i pushen
MIGRATION_DIFF=$(git diff --name-only @{push}..HEAD 2>/dev/null | grep "prisma/migrations.*\.sql$" || echo "")
if [[ -n "$MIGRATION_DIFF" ]]; then
  echo ""
  echo "=========================================="
  echo "  NYA MIGRATIONER DETEKTERADE"
  echo "=========================================="
  echo "$MIGRATION_DIFF" | sed 's/^/  /'
  echo ""
  echo "  KÃ¶r: npm run migrate:supabase"
  echo "=========================================="
  echo ""
fi

# Check for missing Swedish characters (Ã¥, Ã¤, Ã¶)
echo "ğŸ‡¸ğŸ‡ª Checking Swedish characters..."
npm run check:swedish || {
  echo "âŒ Swedish character issues found! Fix before pushing."
  exit 1
}

echo ""

# Run unit tests
echo "ğŸ“Š Running unit tests..."
npm run test:run || {
  echo "âŒ Unit tests failed! Fix tests before pushing."
  exit 1
}

echo ""

# Run TypeScript check (incremental for speed, excludes test files for memory)
echo "ğŸ” Running TypeScript check..."
npx tsc --project tsconfig.typecheck.json || {
  echo "âŒ TypeScript errors found! Fix type errors before pushing."
  exit 1
}

echo ""

# Run lint check
echo "ğŸ” Running lint check..."
npm run lint || {
  echo "âŒ Lint errors found! Fix lint errors before pushing."
  exit 1
}

echo ""
echo "âœ… All local checks passed! Pushing to remote..."
